"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}();!function(){function t(t,i,r){if("[object Array]"===Object.prototype.toString.call(i))e(t,i,r);else{var s=t[i];"[object Array]"===Object.prototype.toString.call(s)?a(s,r):"[object Object]"===s.toString()?n(s,r):Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){return s},set:function(t){t!==s&&r.forEach(function(e){e(s,t)}),s=t}})}}function e(e,a,n){var i=e,r=void 0;a.forEach(function(t,e){parseInt(t)===t&&(t=parseInt(t)),e<a.length-1?i=i[t]:r=t}),t(i,r,n)}function a(t,e){var a=["push","pop","shift","unshift","splice","sort","reverse"],n=Array.prototype,i=Object.create(Array.prototype);a.forEach(function(a){Object.defineProperty(i,a,{writable:!0,enumerable:!0,configurable:!0,value:function(){for(var i,r=this,s=arguments.length,o=Array(s),c=0;c<s;c++)o[c]=arguments[c];var h=t.slice(),l=(i=n[a]).call.apply(i,[this].concat(o));return e.forEach(function(t){t.apply(void 0,[h,r].concat(o))}),l}})}),t.__proto__=i}function n(e,a){Object.keys(e).forEach(function(n){t(e,n,a)})}var i=function(){function e(){_classCallCheck(this,e),this.routes=[]}return _createClass(e,[{key:"regist",value:function(t,e,a){var n=this.routes.find(function(a){if((a.key===e||a.key.toString()===e.toString())&&Object.is(a.obj,t))return a});n?n.fn.push(a):this.routes.push({obj:t,key:e,fn:[a]})}},{key:"build",value:function(){this.routes.forEach(function(e){t(e.obj,e.key,e.fn)})}}]),e}(),r=function(){function t(e,a,n){_classCallCheck(this,t),this._data=a,this.$register=new i,this.$el=document.querySelector(e),this.$elist=n,this.$frag=this.node2Fragment(this.$el),this.scan(this.$frag),this.$el.appendChild(this.$frag),this.$register.build()}return _createClass(t,[{key:"node2Fragment",value:function(t){for(var e=document.createDocumentFragment(),a=t.firstChild;a;)e.appendChild(a),a=t.firstChild;return e}},{key:"scan",value:function(t){if(t!==this.$frag&&t.getAttribute("zen-list"))this.parseList(t);else for(var e=0;e<t.children.length;e++){var a=t.children[e];t.path&&(a.path=t.path),this.parseEvent(a),this.parseClass(a),this.parseModel(a),a.children.length&&this.scan(a)}}},{key:"parseData",value:function(t,e){var a=this,n=void 0,i=void 0,r=1,s=[];if(t.split(":").forEach(function(t,o){0===o?(n=a._data[t],s.push(t)):(e.path?(i=e.path[r++])===t?n=n[t]:(s.push(i),n=n[i][t],r++):n=n[t],s.push(t))}),e.path&&e.path.length>s.length){var o=e.path[e.path.length-1];if("number"!=typeof o)return;n=n[o],s.push(o)}return e.path&&e.path===s||(e.path=s),{path:s,data:n}}},{key:"parseEvent",value:function(t){if(t.getAttribute("zen-event")){var e=t.getAttribute("zen-event"),a=this.$elist[e].type,n=this.$elist[e].fn.bind(t);if("input"===a){var i=!1;t.addEventListener("compositionstart",function(){i=!0}),t.addEventListener("compositionend",function(){i=!1,t.dispatchEvent(new Event("input"))}),t.addEventListener("input",function(){if(!i){var t=this.selectionStart,e=this.selectionEnd;n(),this.setSelectionRange(t,e)}})}else t.addEventListener(a,n)}}},{key:"parseClass",value:function(t){if(t.getAttribute("zen-class")){var e=t.getAttribute("zen-class"),a=this.parseData(e,t);t.classList.contains(a.data)||t.classList.add(a.data),this.$register.regist(this._data,a.path,function(e,a){t.classList.remove(e),t.classList.add(a)})}}},{key:"parseModel",value:function(t){if(t.getAttribute("zen-model")){var e=t.getAttribute("zen-model"),a=this.parseData(e,t);"INPUT"===t.tagName?t.value=a.data:t.innerText=a.data,this.$register.regist(this._data,a.path,function(e,a){"INPUT"===t.tagName?t.value=a:t.innerText=a})}}},{key:"parseList",value:function(t){var e=this,a=this.parseListItem(t),n=t.getAttribute("zen-list"),i=this.parseData(n,t);i.data.forEach(function(n,i){var r=a.cloneNode(!0);t.path&&(r.path=t.path.slice()),r.path||(r.path=[]),r.path.push(i),e.scan(r),t.insertBefore(r,a)}),t.removeChild(a),this.$register.regist(this._data,i.path,function(){for(;t.firstChild;)t.removeChild(t.firstChild);var i=e.parseData(n,t);t.appendChild(a),i.data.forEach(function(n,i){var r=a.cloneNode(!0);t.path&&(r.path=t.path.slice()),r.path||(r.path=[]),r.path.push(i),e.scan(r),t.insertBefore(r,a)}),t.removeChild(a)})}},{key:"parseListItem",value:function(t){var e=this,a=void 0;return function t(n){for(var i=0;i<n.children.length;i++){var r=n.children[i];n.path&&(r.path=n.path.slice()),e.parseEvent(r),e.parseClass(r),e.parseModel(r),r.getAttribute("zen-list-item")?a=r:t(r)}}(t),a}}]),t}();window.Zender=r}();