"use strict";!function(){var t=function(){this.routes=[]};t.prototype={regist:function(t,e,i){var n=this.routes.find(function(i){if((i.key===e||i.key.toString()===e.toString())&&Object.is(i.obj,t))return i});n?n.fn.push(i):this.routes.push({obj:t,key:e,fn:[i]})},build:function(){this.routes.forEach(function(t){e(t.obj,t.key,t.fn)})}},window.Zender=function(e,i,n){this._data=i,this.$register=new t,this.$el=document.querySelector(e),this.$elist=n,this.$frag=this.node2Fragment(this.$el),this.scan(this.$frag),this.$el.appendChild(this.$frag),this.$register.build()},Zender.prototype={node2Fragment:function(t){for(var e=document.createDocumentFragment(),i=t.firstChild;i;)e.appendChild(i),i=t.firstChild;return e},scan:function(t){if(t!==this.$frag&&t.getAttribute("zen-list"))this.parseList(t);else for(var e=0;e<t.children.length;e++){var i=t.children[e];t.path&&(i.path=t.path),this.parseEvent(i),this.parseClass(i),this.parseModel(i),i.children.length&&this.scan(i)}},parseData:function(t,e){var i,n,a=this,r=1,s=[];if(t.split(":").forEach(function(t,o){0===o?(i=a._data[t],s.push(t)):(e.path?(n=e.path[r++])===t?i=i[t]:(s.push(n),i=i[n][t],r++):i=i[t],s.push(t))}),e.path&&e.path.length>s.length){var o=e.path[e.path.length-1];if("number"!=typeof o)return;i=i[o],s.push(o)}return e.path&&e.path===s||(e.path=s),{path:s,data:i}},parseEvent:function(t){if(t.getAttribute("zen-event")){var e=t.getAttribute("zen-event"),i=this.$elist[e].type,n=this.$elist[e].fn.bind(t);if("input"===i){var a=!1;t.addEventListener("compositionstart",function(){a=!0}),t.addEventListener("compositionend",function(){a=!1,t.dispatchEvent(new Event("input"))}),t.addEventListener("input",function(){if(!a){var t=this.selectionStart,e=this.selectionEnd;n(),this.setSelectionRange(t,e)}})}else t.addEventListener(i,n)}},parseClass:function(t){if(t.getAttribute("zen-class")){var e=t.getAttribute("zen-class"),i=this.parseData(e,t);t.classList.contains(i.data)||t.classList.add(i.data),this.$register.regist(this._data,i.path,function(e,i){t.classList.remove(e),t.classList.add(i)})}},parseModel:function(t){if(t.getAttribute("zen-model")){var e=t.getAttribute("zen-model"),i=this.parseData(e,t);"INPUT"===t.tagName?t.value=i.data:t.innerText=i.data,this.$register.regist(this._data,i.path,function(e,i){"INPUT"===t.tagName?t.value=i:t.innerText=i})}},parseList:function(t){var e=this,i=this.parseListItem(t),n=t.getAttribute("zen-list"),a=this.parseData(n,t);a.data.forEach(function(n,a){var r=i.cloneNode(!0);t.path&&(r.path=t.path.slice()),r.path||(r.path=[]),r.path.push(a),e.scan(r),t.insertBefore(r,i)}),t.removeChild(i),this.$register.regist(this._data,a.path,function(){for(;t.firstChild;)t.removeChild(t.firstChild);var a=e.parseData(n,t);t.appendChild(i),a.data.forEach(function(n,a){var r=i.cloneNode(!0);t.path&&(r.path=t.path.slice()),r.path||(r.path=[]),r.path.push(a),e.scan(r),t.insertBefore(r,i)}),t.removeChild(i)})},parseListItem:function(t){var e,i=this;return function t(n){for(var a=0;a<n.children.length;a++){var r=n.children[a];n.path&&(r.path=n.path.slice()),i.parseEvent(r),i.parseClass(r),i.parseModel(r),r.getAttribute("zen-list-item")?e=r:t(r)}}(t),e}};var e=function(t,e,r){if("[object Array]"===Object.prototype.toString.call(e))i(t,e,r);else{var s=t[e];"[object Array]"===Object.prototype.toString.call(s)?n(s,r):"[object Object]"===s.toString()?a(s,r):Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){return s},set:function(t){t!==s&&r.forEach(function(e){e(s,t)}),s=t}})}},i=function(t,i,n){var a,r=t;i.forEach(function(t,e){parseInt(t)===t&&(t=parseInt(t)),e<i.length-1?r=r[t]:a=t}),e(r,a,n)},n=function(t,e){var i=["push","pop","shift","unshift","splice","sort","reverse"],n=Array.prototype,a=Object.create(Array.prototype);i.forEach(function(i){Object.defineProperty(a,i,{writable:!0,enumerable:!0,configurable:!0,value:function(){for(var a,r=this,s=arguments.length,o=Array(s),h=0;h<s;h++)o[h]=arguments[h];var c=t.slice(),p=(a=n[i]).call.apply(a,[this].concat(o));return e.forEach(function(t){t.apply(void 0,[c,r].concat(o))}),p}})}),t.__proto__=a},a=function(t,i){Object.keys(t).forEach(function(n){e(t,n,i)})}}();